<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบขอจองรถใช้งาน - แผนกบริการยานยนต์</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #1e3a8a;
            --primary-light: #3b82f6;
            --secondary: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --border: #e2e8f0;
            --repair: #f97316;
            --retired: #6b7280;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: white;
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 30px;
        }

        .logo-text h1 {
            color: var(--dark);
            font-size: 24px;
            margin-bottom: 5px;
        }

        .logo-text p {
            color: var(--gray);
            font-size: 14px;
        }

        .auth-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            background: var(--light);
            padding: 10px 20px;
            border-radius: 50px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .user-info i {
            color: var(--primary);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 58, 138, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #0ca678;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-outline {
            background: white;
            color: var(--dark);
            border: 1px solid var(--border);
        }

        .btn-outline:hover {
            background: var(--light);
        }

        /* Admin Bar */
        .admin-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 30px;
            display: none;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .admin-bar h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Form Card */
        .form-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            color: var(--dark);
            font-size: 20px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .required::after {
            content: " *";
            color: var(--danger);
        }

        .input-wrapper {
            position: relative;
        }

        .input-wrapper i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        input, select, textarea {
            width: 100%;
            padding: 14px 14px 14px 45px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .search-wrapper {
            display: flex;
            gap: 10px;
        }

        .search-wrapper input {
            flex: 1;
        }

        .search-wrapper button {
            padding: 14px 25px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .search-wrapper button:hover {
            background: var(--primary-light);
        }

        /* Employee Info */
        .employee-info {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            display: none;
            border-left: 4px solid var(--success);
        }

        .employee-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .info-item .label {
            font-size: 13px;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .info-item .value {
            font-weight: 600;
            color: var(--dark);
        }

        /* Car Options */
        .car-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .car-option {
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .car-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .car-option.selected {
            border-color: var(--primary);
            background: rgba(30, 58, 138, 0.05);
        }

        .car-option.unavailable {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .car-option.unavailable:hover {
            transform: none;
            box-shadow: none;
        }

        .car-icon {
            font-size: 30px;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .car-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .car-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 20px;
            display: inline-block;
            font-weight: 600;
        }

        .status-available {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .status-repair {
            background: rgba(249, 115, 22, 0.15);
            color: var(--repair);
        }

        .status-unavailable {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .status-retired {
            background: rgba(107, 114, 128, 0.15);
            color: var(--retired);
        }

        /* Date Time Group */
        .datetime-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .duration-display {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            margin-top: 15px;
        }

        .duration-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .duration-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .duration-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        /* Button Group */
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }

        /* Info Card */
        .info-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px dashed var(--border);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            color: var(--gray);
        }

        .summary-value {
            font-weight: 600;
            color: var(--dark);
            text-align: right;
        }

        /* Car List */
        .car-list {
            margin-top: 20px;
        }

        .car-list-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--light);
            border-radius: 10px;
            margin-bottom: 10px;
            gap: 15px;
        }

        .car-list-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        .car-list-info {
            flex: 1;
        }

        .car-list-name {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .car-list-type {
            font-size: 12px;
            color: var(--gray);
        }

        .car-list-badge {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
        }

        /* Car Management */
        .car-management {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            display: none;
        }

        .car-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .car-manage-item {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid var(--border);
        }

        .car-manage-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .car-manage-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary);
        }

        .car-manage-title {
            flex: 1;
        }

        .car-manage-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 3px;
        }

        .car-manage-type {
            font-size: 13px;
            color: var(--gray);
        }

        .car-manage-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--border);
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .car-manage-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .status-btn {
            padding: 8px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .status-btn.available {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .status-btn.available:hover {
            background: rgba(16, 185, 129, 0.25);
        }

        .status-btn.repair {
            background: rgba(249, 115, 22, 0.15);
            color: var(--repair);
        }

        .status-btn.repair:hover {
            background: rgba(249, 115, 22, 0.25);
        }

        .status-btn.unavailable {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .status-btn.unavailable:hover {
            background: rgba(239, 68, 68, 0.25);
        }

        .status-btn.retired {
            background: rgba(107, 114, 128, 0.15);
            color: var(--retired);
        }

        .status-btn.retired:hover {
            background: rgba(107, 114, 128, 0.25);
        }

        /* Auto Complete */
        .auto-complete {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-height: 250px;
            overflow-y: auto;
            display: none;
        }

        .auto-complete-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
        }

        .auto-complete-item:last-child {
            border-bottom: none;
        }

        .auto-complete-item:hover {
            background: var(--light);
        }

        .auto-complete-code {
            font-weight: 600;
            color: var(--primary);
            margin-right: 10px;
        }

        /* Loading */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .loading-spinner {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
        }

        .loading-spinner i {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        /* Error Message */
        .error-message {
            color: var(--danger);
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }

        .input-error {
            border-color: var(--danger) !important;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            color: var(--dark);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: white;
            opacity: 0.8;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>กำลังโหลดข้อมูล...</p>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">เข้าสู่ระบบ</h3>
                <button class="close-modal" id="closeLoginModal">&times;</button>
            </div>
            <div class="form-group">
                <label>ชื่อผู้ใช้</label>
                <div class="input-wrapper">
                    <i class="fas fa-user"></i>
                    <input type="text" id="username" placeholder="กรอกชื่อผู้ใช้">
                </div>
            </div>
            <div class="form-group">
                <label>รหัสผ่าน</label>
                <div class="input-wrapper">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="password" placeholder="กรอกรหัสผ่าน">
                </div>
            </div>
            <div class="form-group">
                <label>สิทธิ์การใช้งาน</label>
                <select id="role">
                    <option value="admin">ผู้ดูแลระบบ</option>
                    <option value="user">ผู้ใช้งานทั่วไป</option>
                </select>
            </div>
            <button class="btn btn-primary" id="loginBtn" style="width: 100%;">
                <i class="fas fa-sign-in-alt"></i> เข้าสู่ระบบ
            </button>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-area">
                <div class="logo-icon">
                    <i class="fas fa-car"></i>
                </div>
                <div class="logo-text">
                    <h1>ระบบขอจองรถใช้งาน</h1>
                    <p>แผนกบริการยานยนต์ - Vehicle Department</p>
                </div>
            </div>
            <div class="auth-area">
                <div class="user-info" id="userInfo">
                    <i class="fas fa-user-circle"></i>
                    <span id="currentUser"></span>
                    (<span id="currentRole"></span>)
                </div>
                <button class="btn btn-success" id="approveBtn">
                    <i class="fas fa-clipboard-check"></i> อนุมัติ
                </button>
                <button class="btn btn-danger" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> ออกจากระบบ
                </button>
                <button class="btn btn-primary" id="showLoginBtn">
                    <i class="fas fa-sign-in-alt"></i> เข้าสู่ระบบ
                </button>
            </div>
        </div>

        <!-- Admin Bar -->
        <div class="admin-bar" id="adminBar">
            <h3>
                <i class="fas fa-tools"></i>
                โหมดจัดการสถานะรถ (ผู้ดูแลระบบ)
            </h3>
            <button class="btn btn-warning" id="refreshCarsBtn">
                <i class="fas fa-sync-alt"></i> รีเฟรชข้อมูล
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Form Card -->
            <div class="form-card">
                <h2 class="card-title">
                    <i class="fas fa-pen"></i>
                    แบบฟอร์มขอจองรถ
                </h2>

                <!-- ค้นหาพนักงาน -->
                <div class="form-group">
                    <label class="required">รหัสพนักงาน / ชื่อพนักงาน</label>
                    <div class="search-wrapper">
                        <div style="position: relative; flex: 1;">
                            <input type="text" id="employeeSearch" placeholder="กรอกรหัสพนักงานหรือชื่อ">
                            <div class="auto-complete" id="autoComplete"></div>
                        </div>
                        <button id="searchEmployeeBtn">
                            <i class="fas fa-search"></i> ค้นหา
                        </button>
                    </div>
                    <div class="error-message" id="employeeError">กรุณากรอกรหัสพนักงาน</div>
                </div>

                <!-- ข้อมูลพนักงาน -->
                <div class="employee-info" id="employeeInfo">
                    <div class="employee-grid">
                        <div class="info-item">
                            <div class="label">รหัสพนักงาน</div>
                            <div class="value" id="empCode">-</div>
                        </div>
                        <div class="info-item">
                            <div class="label">ชื่อ-สกุล</div>
                            <div class="value" id="empName">-</div>
                        </div>
                        <div class="info-item">
                            <div class="label">ฝ่าย/แผนก</div>
                            <div class="value" id="empDept">-</div>
                        </div>
                        <div class="info-item">
                            <div class="label">ส่วนงาน</div>
                            <div class="value" id="empSection">-</div>
                        </div>
                        <div class="info-item">
                            <div class="label">ตำแหน่ง</div>
                            <div class="value" id="empPosition">-</div>
                        </div>
                    </div>
                </div>

                <!-- เบอร์ติดต่อ -->
                <div class="form-group">
                    <label class="required">เบอร์โทรติดต่อ</label>
                    <div class="input-wrapper">
                        <i class="fas fa-phone"></i>
                        <input type="tel" id="contact" placeholder="เช่น 089-XXX-XXXX">
                    </div>
                    <div class="error-message" id="contactError">กรุณากรอกเบอร์โทรติดต่อ</div>
                </div>

                <!-- เลือกรถ -->
                <div class="form-group">
                    <label class="required">เลือกรถที่ต้องการจอง</label>
                    <div class="car-options" id="carOptions">
                        <!-- สร้างด้วย JavaScript -->
                    </div>
                    <input type="hidden" id="selectedCar" value="">
                    <div class="error-message" id="carError">กรุณาเลือกรถ</div>
                </div>

                <!-- วันที่และเวลา -->
                <div class="form-group">
                    <label class="required">วันที่เริ่มจอง</label>
                    <div class="datetime-group">
                        <div class="input-wrapper">
                            <i class="fas fa-calendar"></i>
                            <input type="date" id="startDate">
                        </div>
                        <div class="input-wrapper">
                            <i class="fas fa-clock"></i>
                            <input type="time" id="startTime" value="08:00">
                        </div>
                    </div>
                    <div class="error-message" id="startDateError">กรุณาเลือกวันที่เริ่มจอง</div>
                </div>

                <div class="form-group">
                    <label class="required">วันที่สิ้นสุดการจอง</label>
                    <div class="datetime-group">
                        <div class="input-wrapper">
                            <i class="fas fa-calendar"></i>
                            <input type="date" id="endDate">
                        </div>
                        <div class="input-wrapper">
                            <i class="fas fa-clock"></i>
                            <input type="time" id="endTime" value="17:00">
                        </div>
                    </div>
                    <div class="error-message" id="endDateError">กรุณาเลือกวันที่สิ้นสุดการจอง</div>
                </div>

                <!-- แสดงระยะเวลา -->
                <div class="duration-display" id="durationDisplay">
                    ระยะเวลาการจอง: -
                </div>

                <!-- เหตุผล -->
                <div class="form-group">
                    <label class="required">เหตุผลในการขอใช้รถ</label>
                    <textarea id="reason" placeholder="กรอกรายละเอียดเหตุผล..."></textarea>
                    <div class="error-message" id="reasonError">กรุณากรอกเหตุผล</div>
                </div>

                <!-- ปุ่มดำเนินการ -->
                <div class="button-group">
                    <button class="btn btn-primary" id="submitBtn">
                        <i class="fas fa-paper-plane"></i> ส่งคำขอ
                    </button>
                    <button class="btn btn-outline" id="resetBtn">
                        <i class="fas fa-redo"></i> ล้างข้อมูล
                    </button>
                </div>
            </div>

            <!-- Info Card -->
            <div class="info-card">
                <h2 class="card-title">
                    <i class="fas fa-info-circle"></i>
                    ข้อมูลการจอง
                </h2>

                <!-- สรุปการจอง -->
                <div id="summary">
                    <div class="summary-item">
                        <span class="summary-label">รหัสพนักงาน:</span>
                        <span class="summary-value" id="summaryCode">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ชื่อ-สกุล:</span>
                        <span class="summary-value" id="summaryName">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ฝ่าย/แผนก:</span>
                        <span class="summary-value" id="summaryDept">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">เบอร์ติดต่อ:</span>
                        <span class="summary-value" id="summaryContact">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">รถที่เลือก:</span>
                        <span class="summary-value" id="summaryCar">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">สถานะรถ:</span>
                        <span class="summary-value" id="summaryCarStatus">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">วันที่เริ่ม:</span>
                        <span class="summary-value" id="summaryStart">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">วันที่สิ้นสุด:</span>
                        <span class="summary-value" id="summaryEnd">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ระยะเวลา:</span>
                        <span class="summary-value" id="summaryDuration">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">เหตุผล:</span>
                        <span class="summary-value" id="summaryReason">-</span>
                    </div>
                </div>

                <!-- รายการรถทั้งหมด -->
                <h3 style="margin: 30px 0 15px; color: var(--dark);">รายการรถทั้งหมด</h3>
                <div class="car-list" id="carList">
                    <!-- สร้างด้วย JavaScript -->
                </div>

                <!-- คำอธิบายสถานะ -->
                <div style="margin-top: 20px; padding: 15px; background: var(--light); border-radius: 10px;">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <span><span style="color: var(--success);">●</span> พร้อมใช้งาน</span>
                        <span><span style="color: var(--repair);">●</span> กำลังซ่อมแซม</span>
                        <span><span style="color: var(--danger);">●</span> ไม่พร้อมใช้งาน</span>
                        <span><span style="color: var(--retired);">●</span> ปลดการใช้</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Car Management (สำหรับ Admin) -->
        <div class="car-management" id="carManagement">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 class="card-title" style="margin: 0;">
                    <i class="fas fa-edit"></i>
                    จัดการสถานะรถ
                </h2>
                <button class="btn btn-success" id="saveCarStatusBtn">
                    <i class="fas fa-save"></i> บันทึก
                </button>
            </div>
            <div class="car-grid" id="carManagementGrid">
                <!-- สร้างด้วย JavaScript -->
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>ระบบขอจองรถใช้งานบริษัท - แผนกยานยนต์ | © 2026 Tokai Solid Tire</p>
        </div>
    </div>

    <script>
        // ==============================================
        // ตัวแปรและค่าคงที่
        // ==============================================
        
        const API_URL = 'https://script.google.com/macros/s/AKfycbwXoNtc7cUKEDud1uZVQuuKCpSHimjzmEkKQ0ubr7egdWh6LbM-1GPwcVSUhrv4OdPE/exec';
        
        let employees = [];
        let cars = [];
        let currentUser = null;
        let currentRole = null;
        let selectedEmployee = null;

        // ==============================================
        // ฟังก์ชันจัดการ Loading
        // ==============================================
        
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // ==============================================
        // ฟังก์ชันแสดง Notification
        // ==============================================
        
        function showNotification(title, message, type = 'success') {
            Swal.fire({
                icon: type,
                title: title,
                text: message,
                confirmButtonColor: '#1e3a8a',
                timer: type === 'success' ? 2000 : null,
                showConfirmButton: type !== 'success'
            });
        }

        // ==============================================
        // ฟังก์ชันดึงข้อมูลจาก Server
        // ==============================================
        
        async function fetchFromAPI(action, params = {}) {
            try {
                showLoading();
                
                const url = new URL(API_URL);
                url.searchParams.append('action', action);
                
                Object.keys(params).forEach(key => {
                    url.searchParams.append(key, params[key]);
                });
                
                const response = await fetch(url.toString());
                const result = await response.json();
                
                return result;
            } catch (error) {
                console.error('API Error:', error);
                showNotification('เกิดข้อผิดพลาด', 'ไม่สามารถเชื่อมต่อกับเซิร์ฟเวอร์ได้', 'error');
                return null;
            } finally {
                hideLoading();
            }
        }

        // ==============================================
        // ฟังก์ชันโหลดข้อมูลรถ
        // ==============================================
        
        async function loadCars() {
            const result = await fetchFromAPI('getCars');
            
            if (result && result.success) {
                cars = result.data;
                renderCarOptions();
                renderCarList();
                renderCarManagement();
                return true;
            }
            
            // ถ้าโหลดไม่ได้ ใช้ข้อมูลตัวอย่าง
            cars = [
                { id: 1, name: 'นาวาร่า', type: 'รถกระบะ', icon: 'fa-truck-pickup', status: 'available', statusText: 'พร้อมใช้งาน' },
                { id: 2, name: 'รถกระบะขาว', type: 'รถกระบะ', icon: 'fa-truck-pickup', status: 'available', statusText: 'พร้อมใช้งาน' },
                { id: 3, name: 'x-lift No.1', type: 'รถกระเช้า', icon: 'fa-truck', status: 'available', statusText: 'พร้อมใช้งาน' },
                { id: 4, name: 'x-lift No.2', type: 'รถกระเช้า', icon: 'fa-truck', status: 'repair', statusText: 'กำลังซ่อมแซม' },
                { id: 5, name: 'x-lift No.3', type: 'รถกระเช้า', icon: 'fa-truck', status: 'available', statusText: 'พร้อมใช้งาน' },
                { id: 6, name: 'x-lift No.4', type: 'รถกระเช้า', icon: 'fa-truck', status: 'unavailable', statusText: 'ไม่พร้อมใช้งาน' },
                { id: 7, name: 'Fork-lift No.1', type: 'รถยก', icon: 'fa-truck', status: 'available', statusText: 'พร้อมใช้งาน' },
                { id: 8, name: 'Fork-lift No.2', type: 'รถยก', icon: 'fa-truck', status: 'repair', statusText: 'กำลังซ่อมแซม' },
                { id: 9, name: 'Fork-lift No.3', type: 'รถยก', icon: 'fa-truck', status: 'available', statusText: 'พร้อมใช้งาน' },
                { id: 10, name: 'Fork-lift No.4', type: 'รถยก', icon: 'fa-truck', status: 'available', statusText: 'พร้อมใช้งาน' },
                { id: 11, name: 'Fork-lift No.5', type: 'รถยก', icon: 'fa-truck', status: 'unavailable', statusText: 'ไม่พร้อมใช้งาน' },
                { id: 12, name: 'Fork-lift No.6', type: 'รถยก', icon: 'fa-truck', status: 'available', statusText: 'พร้อมใช้งาน' },
                { id: 13, name: 'Fork-lift No.7', type: 'รถยก', icon: 'fa-truck', status: 'repair', statusText: 'กำลังซ่อมแซม' },
                { id: 14, name: 'Fork-lift No.8', type: 'รถยก', icon: 'fa-truck', status: 'available', statusText: 'พร้อมใช้งาน' },
                { id: 15, name: 'Fork-lift No.9', type: 'รถยก', icon: 'fa-truck', status: 'retired', statusText: 'ปลดการใช้' }
            ];
            
            renderCarOptions();
            renderCarList();
            return false;
        }

        // ==============================================
        // ฟังก์ชันโหลดข้อมูลพนักงาน
        // ==============================================
        
        async function loadEmployees() {
            const result = await fetchFromAPI('getEmployees');
            
            if (result && result.success) {
                employees = result.data;
                return true;
            }
            
            // ข้อมูลตัวอย่าง
            employees = [
                { code: 'EMP001', name: 'สมชาย ใจดี', section: 'ซ่อมบำรุง', department: 'แผนกยานยนต์', position: 'วิศวกร' },
                { code: 'EMP002', name: 'สุนิตา รักงาน', section: 'บริหาร', department: 'แผนกยานยนต์', position: 'หัวหน้าแผนก' },
                { code: 'EMP003', name: 'ประยุทธ ทำงานเก่ง', section: 'ซ่อมบำรุง', department: 'แผนกยานยนต์', position: 'ช่างซ่อม' }
            ];
            
            return false;
        }

        // ==============================================
        // ฟังก์ชันค้นหาพนักงาน
        // ==============================================
        
        function searchEmployee() {
            const searchText = document.getElementById('employeeSearch').value.trim();
            
            if (!searchText) {
                document.getElementById('employeeError').style.display = 'block';
                return;
            }
            
            const employee = employees.find(emp => 
                emp.code === searchText || 
                emp.name.includes(searchText)
            );
            
            if (employee) {
                selectedEmployee = employee;
                
                // แสดงข้อมูลพนักงาน
                document.getElementById('empCode').textContent = employee.code;
                document.getElementById('empName').textContent = employee.name;
                document.getElementById('empDept').textContent = employee.department;
                document.getElementById('empSection').textContent = employee.section;
                document.getElementById('empPosition').textContent = employee.position;
                
                document.getElementById('employeeInfo').style.display = 'block';
                document.getElementById('employeeError').style.display = 'none';
                document.getElementById('employeeSearch').classList.remove('input-error');
                
                // อัพเดทสรุป
                updateSummary();
            } else {
                document.getElementById('employeeError').textContent = 'ไม่พบข้อมูลพนักงาน';
                document.getElementById('employeeError').style.display = 'block';
                document.getElementById('employeeSearch').classList.add('input-error');
                document.getElementById('employeeInfo').style.display = 'none';
                selectedEmployee = null;
            }
        }

        // ==============================================
        // ฟังก์ชัน Auto Complete
        // ==============================================
        
        function showAutoComplete(searchText) {
            const container = document.getElementById('autoComplete');
            
            if (!searchText || searchText.length < 1) {
                container.style.display = 'none';
                return;
            }
            
            const filtered = employees.filter(emp => 
                emp.code.includes(searchText) || 
                emp.name.includes(searchText)
            ).slice(0, 5);
            
            if (filtered.length === 0) {
                container.style.display = 'none';
                return;
            }
            
            container.innerHTML = '';
            filtered.forEach(emp => {
                const div = document.createElement('div');
                div.className = 'auto-complete-item';
                div.innerHTML = `
                    <span class="auto-complete-code">${emp.code}</span>
                    <span>${emp.name}</span>
                `;
                div.onclick = () => {
                    document.getElementById('employeeSearch').value = emp.code;
                    container.style.display = 'none';
                    searchEmployee();
                };
                container.appendChild(div);
            });
            
            container.style.display = 'block';
        }

        // ==============================================
        // ฟังก์ชันสร้างตัวเลือกรถ
        // ==============================================
        
        function renderCarOptions() {
            const container = document.getElementById('carOptions');
            container.innerHTML = '';
            
            cars.forEach(car => {
                if (car.status === 'retired') return; // ไม่แสดงรถที่ปลดการใช้
                
                const div = document.createElement('div');
                div.className = `car-option ${car.status !== 'available' ? 'unavailable' : ''}`;
                div.setAttribute('data-id', car.id);
                div.setAttribute('data-name', car.name);
                div.setAttribute('data-status', car.status);
                
                div.innerHTML = `
                    <div class="car-icon"><i class="fas ${car.icon}"></i></div>
                    <div class="car-name">${car.name}</div>
                    <div class="car-status status-${car.status}">${car.statusText}</div>
                `;
                
                if (car.status === 'available') {
                    div.onclick = () => {
                        document.querySelectorAll('.car-option').forEach(opt => opt.classList.remove('selected'));
                        div.classList.add('selected');
                        document.getElementById('selectedCar').value = car.name;
                        document.getElementById('carError').style.display = 'none';
                        updateSummary();
                    };
                }
                
                container.appendChild(div);
            });
        }

        // ==============================================
        // ฟังก์ชันสร้างรายการรถ
        // ==============================================
        
        function renderCarList() {
            const container = document.getElementById('carList');
            container.innerHTML = '';
            
            cars.forEach(car => {
                const div = document.createElement('div');
                div.className = 'car-list-item';
                
                div.innerHTML = `
                    <div class="car-list-icon"><i class="fas ${car.icon}"></i></div>
                    <div class="car-list-info">
                        <div class="car-list-name">${car.name}</div>
                        <div class="car-list-type">${car.type}</div>
                    </div>
                    <div class="car-list-badge status-${car.status}">${car.statusText}</div>
                `;
                
                container.appendChild(div);
            });
        }

        // ==============================================
        // ฟังก์ชันสร้างส่วนจัดการรถ (สำหรับ Admin)
        // ==============================================
        
        function renderCarManagement() {
            const container = document.getElementById('carManagementGrid');
            container.innerHTML = '';
            
            cars.forEach(car => {
                const div = document.createElement('div');
                div.className = 'car-manage-item';
                div.setAttribute('data-id', car.id);
                
                div.innerHTML = `
                    <div class="car-manage-header">
                        <div class="car-manage-icon"><i class="fas ${car.icon}"></i></div>
                        <div class="car-manage-title">
                            <div class="car-manage-name">${car.name}</div>
                            <div class="car-manage-type">${car.type}</div>
                        </div>
                    </div>
                    <div class="car-manage-status">
                        <span>สถานะปัจจุบัน:</span>
                        <span class="status-badge status-${car.status}">${car.statusText}</span>
                    </div>
                    <div class="car-manage-actions">
                        <button class="status-btn available" onclick="updateCarStatus(${car.id}, 'available')">
                            <i class="fas fa-check-circle"></i> พร้อมใช้
                        </button>
                        <button class="status-btn repair" onclick="updateCarStatus(${car.id}, 'repair')">
                            <i class="fas fa-tools"></i> ซ่อมแซม
                        </button>
                        <button class="status-btn unavailable" onclick="updateCarStatus(${car.id}, 'unavailable')">
                            <i class="fas fa-times-circle"></i> ไม่พร้อม
                        </button>
                        <button class="status-btn retired" onclick="updateCarStatus(${car.id}, 'retired')">
                            <i class="fas fa-ban"></i> ปลดการใช้
                        </button>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        // ==============================================
        // ฟังก์ชันอัปเดตสถานะรถ
        // ==============================================
        
        async function updateCarStatus(carId, newStatus) {
            const result = await Swal.fire({
                title: 'ยืนยันการเปลี่ยนสถานะ?',
                text: 'คุณต้องการเปลี่ยนสถานะรถนี้หรือไม่?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#1e3a8a',
                cancelButtonColor: '#64748b',
                confirmButtonText: 'ยืนยัน',
                cancelButtonText: 'ยกเลิก'
            });
            
            if (!result.isConfirmed) return;
            
            showLoading();
            
            try {
                const url = `${API_URL}?action=updateCarStatus&carId=${carId}&status=${newStatus}&updatedBy=${currentUser || 'admin'}`;
                const response = await fetch(url);
                const result = await response.json();
                
                if (result.success) {
                    await loadCars(); // โหลดข้อมูลใหม่
                    showNotification('สำเร็จ', 'อัปเดตสถานะรถเรียบร้อย', 'success');
                } else {
                    showNotification('เกิดข้อผิดพลาด', result.message, 'error');
                }
            } catch (error) {
                showNotification('เกิดข้อผิดพลาด', 'ไม่สามารถเชื่อมต่อกับเซิร์ฟเวอร์', 'error');
            } finally {
                hideLoading();
            }
        }

        // ==============================================
        // ฟังก์ชันคำนวณระยะเวลา
        // ==============================================
        
        function calculateDuration() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            if (!startDate || !endDate || !startTime || !endTime) {
                document.getElementById('durationDisplay').textContent = 'ระยะเวลาการจอง: -';
                return;
            }
            
            const start = new Date(`${startDate}T${startTime}`);
            const end = new Date(`${endDate}T${endTime}`);
            
            if (end <= start) {
                document.getElementById('durationDisplay').textContent = 'ระยะเวลาการจอง: วันที่/เวลาไม่ถูกต้อง';
                document.getElementById('durationDisplay').className = 'duration-display duration-danger';
                return;
            }
            
            const diffMs = end - start;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
            
            let text = 'ระยะเวลาการจอง: ';
            if (diffDays > 0) text += `${diffDays} วัน `;
            if (diffHours > 0) text += `${diffHours} ชั่วโมง `;
            if (diffMinutes > 0) text += `${diffMinutes} นาที`;
            
            // ตรวจสอบว่าเกิน 7 วันหรือไม่
            if (diffDays > 7) {
                text += ' (เกิน 7 วัน!)';
                document.getElementById('durationDisplay').className = 'duration-display duration-danger';
            } else if (diffDays > 3) {
                document.getElementById('durationDisplay').className = 'duration-display duration-warning';
            } else {
                document.getElementById('durationDisplay').className = 'duration-display duration-success';
            }
            
            document.getElementById('durationDisplay').textContent = text;
        }

        // ==============================================
        // ฟังก์ชันอัปเดตสรุป
        // ==============================================
        
        function updateSummary() {
            // ข้อมูลพนักงาน
            if (selectedEmployee) {
                document.getElementById('summaryCode').textContent = selectedEmployee.code;
                document.getElementById('summaryName').textContent = selectedEmployee.name;
                document.getElementById('summaryDept').textContent = selectedEmployee.department;
            }
            
            // เบอร์ติดต่อ
            const contact = document.getElementById('contact').value;
            document.getElementById('summaryContact').textContent = contact || '-';
            
            // รถที่เลือก
            const selectedCarName = document.getElementById('selectedCar').value;
            const selectedCar = cars.find(c => c.name === selectedCarName);
            
            if (selectedCar) {
                document.getElementById('summaryCar').textContent = selectedCar.name;
                document.getElementById('summaryCarStatus').textContent = selectedCar.statusText;
            } else {
                document.getElementById('summaryCar').textContent = '-';
                document.getElementById('summaryCarStatus').textContent = '-';
            }
            
            // วันที่
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            if (startDate) {
                const date = new Date(startDate);
                document.getElementById('summaryStart').textContent = date.toLocaleDateString('th-TH') + ' ' + startTime;
            } else {
                document.getElementById('summaryStart').textContent = '-';
            }
            
            if (endDate) {
                const date = new Date(endDate);
                document.getElementById('summaryEnd').textContent = date.toLocaleDateString('th-TH') + ' ' + endTime;
            } else {
                document.getElementById('summaryEnd').textContent = '-';
            }
            
            // ระยะเวลา
            const durationText = document.getElementById('durationDisplay').textContent.replace('ระยะเวลาการจอง: ', '');
            document.getElementById('summaryDuration').textContent = durationText;
            
            // เหตุผล
            const reason = document.getElementById('reason').value;
            document.getElementById('summaryReason').textContent = reason || '-';
        }

        // ==============================================
        // ฟังก์ชันตรวจสอบฟอร์ม
        // ==============================================
        
        function validateForm() {
            let isValid = true;
            
            // ตรวจสอบพนักงาน
            if (!selectedEmployee) {
                document.getElementById('employeeError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('employeeError').style.display = 'none';
            }
            
            // ตรวจสอบเบอร์โทร
            const contact = document.getElementById('contact').value.trim();
            if (!contact) {
                document.getElementById('contactError').style.display = 'block';
                document.getElementById('contact').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('contactError').style.display = 'none';
                document.getElementById('contact').classList.remove('input-error');
            }
            
            // ตรวจสอบรถ
            const selectedCar = document.getElementById('selectedCar').value;
            if (!selectedCar) {
                document.getElementById('carError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('carError').style.display = 'none';
            }
            
            // ตรวจสอบวันที่เริ่ม
            const startDate = document.getElementById('startDate').value;
            if (!startDate) {
                document.getElementById('startDateError').style.display = 'block';
                document.getElementById('startDate').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('startDateError').style.display = 'none';
                document.getElementById('startDate').classList.remove('input-error');
            }
            
            // ตรวจสอบวันที่สิ้นสุด
            const endDate = document.getElementById('endDate').value;
            if (!endDate) {
                document.getElementById('endDateError').style.display = 'block';
                document.getElementById('endDate').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('endDateError').style.display = 'none';
                document.getElementById('endDate').classList.remove('input-error');
            }
            
            // ตรวจสอบเหตุผล
            const reason = document.getElementById('reason').value.trim();
            if (!reason) {
                document.getElementById('reasonError').style.display = 'block';
                document.getElementById('reason').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('reasonError').style.display = 'none';
                document.getElementById('reason').classList.remove('input-error');
            }
            
            return isValid;
        }

        // ==============================================
        // ฟังก์ชันส่งคำขอจอง
        // ==============================================
        
        async function submitReservation() {
            if (!validateForm()) {
                showNotification('ข้อมูลไม่ครบถ้วน', 'กรุณากรอกข้อมูลให้ครบทุกช่อง', 'warning');
                return;
            }
            
            const result = await Swal.fire({
                title: 'ยืนยันการส่งคำขอ?',
                text: 'กรุณาตรวจสอบข้อมูลให้ถูกต้องก่อนส่ง',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#1e3a8a',
                cancelButtonColor: '#64748b',
                confirmButtonText: 'ส่งคำขอ',
                cancelButtonText: 'ตรวจสอบอีกครั้ง'
            });
            
            if (!result.isConfirmed) return;
            
            showLoading();
            
            try {
                const data = {
                    code: selectedEmployee.code,
                    name: selectedEmployee.name,
                    section: selectedEmployee.section,
                    department: selectedEmployee.department,
                    position: selectedEmployee.position,
                    contact: document.getElementById('contact').value.trim(),
                    choose: document.getElementById('selectedCar').value,
                    rentStartdate: document.getElementById('startDate').value,
                    startTime: document.getElementById('startTime').value,
                    rentEnddate: document.getElementById('endDate').value,
                    endTime: document.getElementById('endTime').value,
                    reason: document.getElementById('reason').value.trim()
                };
                
                const response = await fetch(API_URL + '?action=submitReservation', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                showNotification('ส่งคำขอสำเร็จ', 'รอการอนุมัติจากผู้อนุมัติ', 'success');
                
                // รีเซ็ตฟอร์ม
                resetForm();
                
            } catch (error) {
                showNotification('เกิดข้อผิดพลาด', 'ไม่สามารถส่งคำขอได้', 'error');
            } finally {
                hideLoading();
            }
        }

        // ==============================================
        // ฟังก์ชันรีเซ็ตฟอร์ม
        // ==============================================
        
        function resetForm() {
            document.getElementById('employeeSearch').value = '';
            document.getElementById('employeeInfo').style.display = 'none';
            document.getElementById('contact').value = '';
            document.getElementById('selectedCar').value = '';
            document.getElementById('reason').value = '';
            
            document.querySelectorAll('.car-option').forEach(opt => opt.classList.remove('selected'));
            
            selectedEmployee = null;
            
            // รีเซ็ตวันที่
            const today = new Date().toISOString().split('T')[0];
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = nextWeek.toISOString().split('T')[0];
            document.getElementById('startTime').value = '08:00';
            document.getElementById('endTime').value = '17:00';
            
            calculateDuration();
            updateSummary();
        }

        // ==============================================
        // ฟังก์ชันจัดการล็อกอิน
        // ==============================================
        
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            
            // ตัวอย่างการตรวจสอบ (ควรเปลี่ยนเป็นระบบจริง)
            if (username === 'admin' && password === 'admin123') {
                currentUser = username;
                currentRole = role;
                
                // บันทึกลง localStorage
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('currentUser', username);
                localStorage.setItem('currentRole', role);
                
                updateAuthUI();
                document.getElementById('loginModal').style.display = 'none';
                
                showNotification('ยินดีต้อนรับ', 'เข้าสู่ระบบสำเร็จ', 'success');
            } else {
                showNotification('เข้าสู่ระบบไม่สำเร็จ', 'ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง', 'error');
            }
        }

        function logout() {
            currentUser = null;
            currentRole = null;
            
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('currentUser');
            localStorage.removeItem('currentRole');
            
            updateAuthUI();
            showNotification('ออกจากระบบ', 'ออกจากระบบสำเร็จ', 'success');
        }

        function updateAuthUI() {
            const userInfo = document.getElementById('userInfo');
            const approveBtn = document.getElementById('approveBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const loginBtn = document.getElementById('showLoginBtn');
            const adminBar = document.getElementById('adminBar');
            const carManagement = document.getElementById('carManagement');
            
            if (currentUser) {
                document.getElementById('currentUser').textContent = currentUser;
                document.getElementById('currentRole').textContent = currentRole === 'admin' ? 'ผู้ดูแล' : 'ผู้ใช้';
                
                userInfo.style.display = 'flex';
                approveBtn.style.display = 'flex';
                logoutBtn.style.display = 'flex';
                loginBtn.style.display = 'none';
                
                if (currentRole === 'admin') {
                    adminBar.style.display = 'flex';
                    carManagement.style.display = 'block';
                } else {
                    adminBar.style.display = 'none';
                    carManagement.style.display = 'none';
                }
            } else {
                userInfo.style.display = 'none';
                approveBtn.style.display = 'none';
                logoutBtn.style.display = 'none';
                loginBtn.style.display = 'flex';
                adminBar.style.display = 'none';
                carManagement.style.display = 'none';
            }
        }

        // ==============================================
        // Event Listeners
        // ==============================================
        
        document.addEventListener('DOMContentLoaded', async function() {
            // ตรวจสอบสถานะล็อกอิน
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const savedUser = localStorage.getItem('currentUser');
            const savedRole = localStorage.getItem('currentRole');
            
            if (isLoggedIn && savedUser && savedRole) {
                currentUser = savedUser;
                currentRole = savedRole;
            }
            
            updateAuthUI();
            
            // โหลดข้อมูล
            await loadEmployees();
            await loadCars();
            
            // ตั้งค่าวันที่เริ่มต้น
            const today = new Date().toISOString().split('T')[0];
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = nextWeek.toISOString().split('T')[0];
            document.getElementById('startDate').min = today;
            document.getElementById('endDate').min = today;
            
            calculateDuration();
            
            // Event Listeners
            document.getElementById('searchEmployeeBtn').addEventListener('click', searchEmployee);
            document.getElementById('employeeSearch').addEventListener('input', (e) => showAutoComplete(e.target.value));
            document.getElementById('showLoginBtn').addEventListener('click', () => {
                document.getElementById('loginModal').style.display = 'flex';
            });
            document.getElementById('closeLoginModal').addEventListener('click', () => {
                document.getElementById('loginModal').style.display = 'none';
            });
            document.getElementById('loginBtn').addEventListener('click', login);
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('approveBtn').addEventListener('click', () => {
                window.open('approve.html', '_blank');
            });
            document.getElementById('submitBtn').addEventListener('click', submitReservation);
            document.getElementById('resetBtn').addEventListener('click', resetForm);
            document.getElementById('refreshCarsBtn').addEventListener('click', loadCars);
            document.getElementById('saveCarStatusBtn').addEventListener('click', () => {
                showNotification('บันทึกสำเร็จ', 'บันทึกสถานะรถเรียบร้อย', 'success');
            });
            
            // วันที่เปลี่ยนแปลง
            document.getElementById('startDate').addEventListener('change', () => {
                calculateDuration();
                updateSummary();
            });
            document.getElementById('endDate').addEventListener('change', () => {
                calculateDuration();
                updateSummary();
            });
            document.getElementById('startTime').addEventListener('change', () => {
                calculateDuration();
                updateSummary();
            });
            document.getElementById('endTime').addEventListener('change', () => {
                calculateDuration();
                updateSummary();
            });
            document.getElementById('contact').addEventListener('input', updateSummary);
            document.getElementById('reason').addEventListener('input', updateSummary);
            
            // ปิด modal เมื่อคลิกนอก
            document.getElementById('loginModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('loginModal')) {
                    document.getElementById('loginModal').style.display = 'none';
                }
            });
            
            // ปิด auto complete เมื่อคลิกนอก
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#employeeSearch') && !e.target.closest('.auto-complete')) {
                    document.getElementById('autoComplete').style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
