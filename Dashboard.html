<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายงานการจองรถ (Car Rent Report)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Kanit', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 400px;
            height: 400px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            flex: 1;
            min-width: 200px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card.primary {
            border-top: 5px solid #1e3c72;
        }
        
        .stat-card.success {
            border-top: 5px solid #28a745;
        }
        
        .stat-card.warning {
            border-top: 5px solid #ffc107;
        }
        
        .stat-card.danger {
            border-top: 5px solid #dc3545;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.95rem;
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #1e3c72;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 1px solid #ddd;
            border-radius: 50px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #1e3c72;
            box-shadow: 0 0 0 3px rgba(30, 60, 114, 0.1);
        }
        
        .search-box i {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
        }
        
        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            font-size: 0.95rem;
            cursor: pointer;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #1e3c72;
        }
        
        .btn {
            padding: 10px 20px;
            background: #1e3c72;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: #2a5298;
        }
        
        .btn-refresh {
            background: #28a745;
        }
        
        .btn-refresh:hover {
            background: #218838;
        }
        
        table {
            width: 100%;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-collapse: collapse;
        }
        
        thead {
            background: #1e3c72;
            color: white;
        }
        
        th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        tbody tr {
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        td {
            padding: 16px 15px;
            font-size: 0.95rem;
        }
        
        .status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status.approved {
            background: #d4edda;
            color: #155724;
        }
        
        .status.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status.rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 10px;
        }
        
        .page-btn {
            padding: 8px 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-btn:hover {
            background: #f0f0f0;
        }
        
        .page-btn.active {
            background: #1e3c72;
            color: white;
            border-color: #1e3c72;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .no-data {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #666;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #666;
        }
        
        @media (max-width: 1100px) {
            table {
                display: block;
                overflow-x: auto;
            }
            
            .controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .search-box {
                min-width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .stat-card {
                min-width: 100%;
            }
            
            .filters {
                width: 100%;
            }
            
            .filter-select {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-car"></i> รายงานการจองรถ (Car Rent Report)</h1>
                <p class="subtitle">ระบบจัดการข้อมูลการจองรถยนต์สำหรับพนักงาน</p>
                <p>ข้อมูลจาก Google Sheets: <a href="https://docs.google.com/spreadsheets/d/1-5izB7N6ldxHAa3ca0RNhGP8Z36vuA0mw9Wi_xR_Lj4/edit?gid=0#gid=0" style="color: #a3d0fd;">คลิกเพื่อดูสเปรดชีต</a></p>
            </div>
        </header>
        
        <div class="stats-container">
            <div class="stat-card primary">
                <div class="stat-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="stat-value" id="total-bookings">0</div>
                <div class="stat-label">การจองทั้งหมด</div>
            </div>
            
            <div class="stat-card success">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-value" id="approved-bookings">0</div>
                <div class="stat-label">อนุมัติแล้ว</div>
            </div>
            
            <div class="stat-card warning">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-value" id="pending-bookings">0</div>
                <div class="stat-label">รออนุมัติ</div>
            </div>
            
            <div class="stat-card danger">
                <div class="stat-icon">
                    <i class="fas fa-car-side"></i>
                </div>
                <div class="stat-value" id="current-rentals">0</div>
                <div class="stat-label">กำลังใช้งาน</div>
            </div>
        </div>
        
        <div class="controls">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="ค้นหาชื่อพนักงาน, รหัสจอง, แผนก...">
            </div>
            
            <div class="filters">
                <select id="department-filter" class="filter-select">
                    <option value="">ทั้งหมด (แผนก)</option>
                    <option value="IT">IT</option>
                    <option value="HR">HR</option>
                    <option value="Finance">Finance</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Sales">Sales</option>
                </select>
                
                <select id="status-filter" class="filter-select">
                    <option value="">ทั้งหมด (สถานะ)</option>
                    <option value="approved">อนุมัติแล้ว</option>
                    <option value="pending">รออนุมัติ</option>
                    <option value="rejected">ปฏิเสธ</option>
                </select>
                
                <button class="btn" id="export-btn">
                    <i class="fas fa-file-export"></i> ส่งออกรายงาน
                </button>
                
                <button class="btn btn-refresh" id="refresh-btn">
                    <i class="fas fa-sync-alt"></i> รีเฟรชข้อมูล
                </button>
            </div>
        </div>
        
        <div id="table-container">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i> กำลังโหลดข้อมูล...
            </div>
        </div>
        
        <div class="pagination" id="pagination">
            <!-- Pagination will be generated by JavaScript -->
        </div>
        
        <footer>
            <p>Car Rent Report System | อัปเดตล่าสุด: <span id="last-update">-</span></p>
            <p>ข้อมูลจาก Google Sheets และ Google Apps Script</p>
        </footer>
    </div>
    
    <script>
        // ข้อมูลตัวอย่างสำหรับการทดสอบ (จะถูกแทนที่ด้วยข้อมูลจริงจาก API)
        const sampleData = [
            {
                timestamp: "2023-10-15 09:30:00",
                code: "CR-001",
                name: "สมชาย ใจดี",
                section: "พัฒนาโปรแกรม",
                department: "IT",
                position: "โปรแกรมเมอร์",
                contact: "081-234-5678",
                choose: "รถยนต์นั่งส่วนบุคคล",
                rentStartdate: "2023-10-20",
                rentEnddate: "2023-10-22",
                startTime: "09:00",
                endTime: "17:00",
                reason: "ประชุมลูกค้านอกสถานที่",
                approval: "approved"
            },
            {
                timestamp: "2023-10-16 14:20:00",
                code: "CR-002",
                name: "สุนิสา วิเศษ",
                section: "การตลาด",
                department: "Marketing",
                position: "ผู้จัดการฝ่ายการตลาด",
                contact: "082-345-6789",
                choose: "รถตู้",
                rentStartdate: "2023-10-25",
                rentEnddate: "2023-10-25",
                startTime: "08:00",
                endTime: "16:00",
                reason: "นำทีมไปจัดบูธงานแสดงสินค้า",
                approval: "pending"
            },
            {
                timestamp: "2023-10-17 11:15:00",
                code: "CR-003",
                name: "ประยุทธ์ สุขสวัสดิ์",
                section: "การเงิน",
                department: "Finance",
                position: "นักวิเคราะห์การเงิน",
                contact: "083-456-7890",
                choose: "รถยนต์นั่งส่วนบุคคล",
                rentStartdate: "2023-10-30",
                rentEnddate: "2023-11-01",
                startTime: "10:00",
                endTime: "18:00",
                reason: "เดินทางไปตรวจสอบสาขาภูเก็ต",
                approval: "approved"
            },
            {
                timestamp: "2023-10-18 16:45:00",
                code: "CR-004",
                name: "กนกวรรณ พลอยเพชร",
                section: "ทรัพยากรบุคคล",
                department: "HR",
                position: "เจ้าหน้าที่สรรหาบุคลากร",
                contact: "084-567-8901",
                choose: "รถยนต์นั่งส่วนบุคคล",
                rentStartdate: "2023-11-05",
                rentEnddate: "2023-11-05",
                startTime: "13:00",
                endTime: "17:00",
                reason: "สัมภาษณ์งานนอกสถานที่",
                approval: "rejected"
            },
            {
                timestamp: "2023-10-19 10:10:00",
                code: "CR-005",
                name: "ธนวัฒน์ ศรีสวัสดิ์",
                section: "ขาย",
                department: "Sales",
                position: "ผู้จัดการฝ่ายขาย",
                contact: "085-678-9012",
                choose: "รถตู้",
                rentStartdate: "2023-11-10",
                rentEnddate: "2023-11-12",
                startTime: "07:30",
                endTime: "19:00",
                reason: "นำทีมขายไปประชุมประจำปีที่หัวหิน",
                approval: "pending"
            },
            {
                timestamp: "2023-10-20 13:25:00",
                code: "CR-006",
                name: "อรุณี มณีรัตน์",
                section: "พัฒนาโปรแกรม",
                department: "IT",
                position: "วิศวกรซอฟต์แวร์",
                contact: "086-789-0123",
                choose: "รถยนต์นั่งส่วนบุคคล",
                rentStartdate: "2023-11-15",
                rentEnddate: "2023-11-15",
                startTime: "08:00",
                endTime: "16:00",
                reason: "ติดตั้งระบบที่สำนักงานลูกค้า",
                approval: "approved"
            },
            {
                timestamp: "2023-10-21 15:40:00",
                code: "CR-007",
                name: "วีระพล กล้าหาญ",
                section: "การตลาด",
                department: "Marketing",
                position: "ผู้ช่วยผู้จัดการฝ่ายการตลาด",
                contact: "087-890-1234",
                choose: "รถยนต์นั่งส่วนบุคคล",
                rentStartdate: "2023-11-18",
                rentEnddate: "2023-11-20",
                startTime: "09:00",
                endTime: "17:30",
                reason: "สำรวจตลาดและเก็บข้อมูลลูกค้า",
                approval: "approved"
            },
            {
                timestamp: "2023-10-22 09:55:00",
                code: "CR-008",
                name: "พิมพา รักงาน",
                section: "ทรัพยากรบุคคล",
                department: "HR",
                position: "ผู้จัดการฝ่ายทรัพยากรบุคคล",
                contact: "088-901-2345",
                choose: "รถตู้",
                rentStartdate: "2023-11-25",
                rentEnddate: "2023-11-25",
                startTime: "08:30",
                endTime: "16:30",
                reason: "พาพนักงานไปอบรมทีมเวิร์ก",
                approval: "pending"
            }
        ];
        
        // ตัวแปรเก็บข้อมูลและสถานะ
        let allData = [];
        let currentData = [];
        let currentPage = 1;
        const rowsPerPage = 10;
        
        // DOM Elements
        const tableContainer = document.getElementById('table-container');
        const searchInput = document.getElementById('search-input');
        const departmentFilter = document.getElementById('department-filter');
        const statusFilter = document.getElementById('status-filter');
        const refreshBtn = document.getElementById('refresh-btn');
        const exportBtn = document.getElementById('export-btn');
        const paginationContainer = document.getElementById('pagination');
        const lastUpdateElement = document.getElementById('last-update');
        
        // ฟังก์ชันสำหรับดึงข้อมูลจาก Google Apps Script
        async function fetchData() {
            try {
                const scriptUrl = 'https://script.google.com/macros/s/AKfycby-m9UDxmu_YSYJ2x7mOY0ksQtw_rl9Iy3Fs6mP9NhSDQzxErab5RmvvVLAG7O2HpPt/exec';
                
                // สำหรับตัวอย่างนี้เราจะใช้ข้อมูลตัวอย่าง
                // หากต้องการดึงข้อมูลจริงจาก Google Apps Script ให้ใช้โค้ดด้านล่างนี้แทน
                /*
                const response = await fetch(scriptUrl);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                allData = data;
                */
                
                // ใช้ข้อมูลตัวอย่างสำหรับการทดสอบ
                allData = sampleData;
                
                // แสดงข้อมูลล่าสุด
                const now = new Date();
                lastUpdateElement.textContent = now.toLocaleString('th-TH', {
                    day: 'numeric',
                    month: 'numeric',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // กรองข้อมูลตามค่าเริ่มต้น
                filterData();
                
                // อัปเดตสถิติ
                updateStats();
                
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('ไม่สามารถดึงข้อมูลได้ กรุณาลองใหม่อีกครั้ง');
                // ใช้ข้อมูลตัวอย่างถ้าไม่สามารถดึงข้อมูลได้
                allData = sampleData;
                filterData();
                updateStats();
            }
        }
        
        // ฟังก์ชันกรองข้อมูล
        function filterData() {
            let filtered = [...allData];
            
            // กรองตามคำค้นหา
            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(item => 
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.code.toLowerCase().includes(searchTerm) ||
                    item.department.toLowerCase().includes(searchTerm) ||
                    item.section.toLowerCase().includes(searchTerm)
                );
            }
            
            // กรองตามแผนก
            const departmentValue = departmentFilter.value;
            if (departmentValue) {
                filtered = filtered.filter(item => item.department === departmentValue);
            }
            
            // กรองตามสถานะ
            const statusValue = statusFilter.value;
            if (statusValue) {
                filtered = filtered.filter(item => item.approval === statusValue);
            }
            
            currentData = filtered;
            currentPage = 1;
            renderTable();
            renderPagination();
        }
        
        // ฟังก์ชันแสดงตารางข้อมูล
        function renderTable() {
            if (currentData.length === 0) {
                tableContainer.innerHTML = '<div class="no-data"><i class="fas fa-database"></i> ไม่พบข้อมูลที่ตรงกับการค้นหา</div>';
                return;
            }
            
            // คำนวณข้อมูลสำหรับหน้าปัจจุบัน
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const pageData = currentData.slice(startIndex, endIndex);
            
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>รหัสจอง</th>
                            <th>ชื่อ-นามสกุล</th>
                            <th>แผนก/ฝ่าย</th>
                            <th>ตำแหน่ง</th>
                            <th>ประเภทรถ</th>
                            <th>วันที่จอง</th>
                            <th>เวลา</th>
                            <th>วัตถุประสงค์</th>
                            <th>สถานะ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            pageData.forEach(item => {
                // แปลงสถานะเป็นภาษาไทย
                let statusText = '';
                let statusClass = '';
                
                switch(item.approval) {
                    case 'approved':
                        statusText = 'อนุมัติแล้ว';
                        statusClass = 'approved';
                        break;
                    case 'pending':
                        statusText = 'รออนุมัติ';
                        statusClass = 'pending';
                        break;
                    case 'rejected':
                        statusText = 'ปฏิเสธ';
                        statusClass = 'rejected';
                        break;
                    default:
                        statusText = 'รออนุมัติ';
                        statusClass = 'pending';
                }
                
                tableHTML += `
                    <tr>
                        <td><strong>${item.code}</strong></td>
                        <td>${item.name}</td>
                        <td>${item.department}<br><small>${item.section}</small></td>
                        <td>${item.position}</td>
                        <td>${item.choose}</td>
                        <td>${formatDate(item.rentStartdate)} - ${formatDate(item.rentEnddate)}</td>
                        <td>${item.startTime} - ${item.endTime}</td>
                        <td>${item.reason}</td>
                        <td><span class="status ${statusClass}">${statusText}</span></td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            tableContainer.innerHTML = tableHTML;
        }
        
        // ฟังก์ชันแสดง pagination
        function renderPagination() {
            const totalPages = Math.ceil(currentData.length / rowsPerPage);
            
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // ปุ่มย้อนกลับ
            paginationHTML += `
                <button class="page-btn ${currentPage === 1 ? 'disabled' : ''}" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            // หมายเลขหน้า
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHTML += `
                        <button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += `<span class="page-btn disabled">...</span>`;
                }
            }
            
            // ปุ่มถัดไป
            paginationHTML += `
                <button class="page-btn ${currentPage === totalPages ? 'disabled' : ''}" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            paginationContainer.innerHTML = paginationHTML;
        }
        
        // ฟังก์ชันเปลี่ยนหน้า
        function changePage(page) {
            const totalPages = Math.ceil(currentData.length / rowsPerPage);
            
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderTable();
            renderPagination();
        }
        
        // ฟังก์ชันอัปเดตสถิติ
        function updateStats() {
            const totalBookings = allData.length;
            const approvedBookings = allData.filter(item => item.approval === 'approved').length;
            const pendingBookings = allData.filter(item => item.approval === 'pending').length;
            
            // คำนวณจำนวนการจองที่กำลังใช้งาน (วันที่จองรวมถึงวันปัจจุบัน)
            const today = new Date().toISOString().split('T')[0];
            const currentRentals = allData.filter(item => {
                return item.approval === 'approved' && 
                       item.rentStartdate <= today && 
                       item.rentEnddate >= today;
            }).length;
            
            document.getElementById('total-bookings').textContent = totalBookings.toLocaleString();
            document.getElementById('approved-bookings').textContent = approvedBookings.toLocaleString();
            document.getElementById('pending-bookings').textContent = pendingBookings.toLocaleString();
            document.getElementById('current-rentals').textContent = currentRentals.toLocaleString();
        }
        
        // ฟังก์ชันจัดรูปแบบวันที่
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });
        }
        
        // ฟังก์ชันส่งออกรายงาน
        function exportReport() {
            // สร้าง CSV จากข้อมูล
            let csvContent = "รหัสจอง,ชื่อ-นามสกุล,แผนก,ฝ่าย,ตำแหน่ง,ประเภทรถ,วันที่เริ่มจอง,วันที่สิ้นสุดจอง,เวลาเริ่ม,เวลาสิ้นสุด,วัตถุประสงค์,สถานะ\n";
            
            currentData.forEach(item => {
                const statusText = item.approval === 'approved' ? 'อนุมัติแล้ว' : 
                                 item.approval === 'pending' ? 'รออนุมัติ' : 'ปฏิเสธ';
                
                const row = [
                    `"${item.code}"`,
                    `"${item.name}"`,
                    `"${item.department}"`,
                    `"${item.section}"`,
                    `"${item.position}"`,
                    `"${item.choose}"`,
                    `"${item.rentStartdate}"`,
                    `"${item.rentEnddate}"`,
                    `"${item.startTime}"`,
                    `"${item.endTime}"`,
                    `"${item.reason}"`,
                    `"${statusText}"`
                ].join(',');
                
                csvContent += row + "\n";
            });
            
            // สร้าง Blob และดาวน์โหลด
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `car-rent-report-${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('ส่งออกรายงานเรียบร้อยแล้ว');
        }
        
        // เพิ่ม Event Listeners
        searchInput.addEventListener('input', filterData);
        departmentFilter.addEventListener('change', filterData);
        statusFilter.addEventListener('change', filterData);
        refreshBtn.addEventListener('click', fetchData);
        exportBtn.addEventListener('click', exportReport);
        
        // เริ่มต้นโหลดข้อมูลเมื่อหน้าเว็บโหลดเสร็จ
        document.addEventListener('DOMContentLoaded', fetchData);
        
        // ทำให้ฟังก์ชัน changePage สามารถเรียกใช้ได้จาก global scope
        window.changePage = changePage;
    </script>
</body>
</html>
