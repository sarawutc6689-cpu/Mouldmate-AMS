<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบอนุมัติการจองรถ - Car Rent Approval</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .logo i {
            font-size: 2.5rem;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 25px;
        }
        
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #2a5298;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
            flex: 1;
        }
        
        .filter-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #2a5298;
        }
        
        select, input {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .status-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .status-badge.active {
            background-color: #2a5298;
            color: white;
        }
        
        .status-badge.pending {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-badge.approved {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-badge.rejected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #2a5298;
        }
        
        .reservations-container {
            margin-top: 30px;
        }
        
        .reservation-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #ffc107;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .reservation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .reservation-card.approved {
            border-left-color: #28a745;
        }
        
        .reservation-card.rejected {
            border-left-color: #dc3545;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .reservation-code {
            font-size: 1.1rem;
            font-weight: 700;
            color: #2a5298;
            background-color: #eef2ff;
            padding: 5px 15px;
            border-radius: 4px;
        }
        
        .reservation-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .card-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .info-group {
            margin-bottom: 10px;
        }
        
        .info-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-weight: 600;
            color: #333;
        }
        
        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid #eee;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .timestamp {
            font-size: 0.85rem;
            color: #888;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-approve {
            background-color: #28a745;
            color: white;
        }
        
        .btn-approve:hover {
            background-color: #218838;
        }
        
        .btn-reject {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-reject:hover {
            background-color: #c82333;
        }
        
        .btn-view {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-view:hover {
            background-color: #138496;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: #2a5298;
        }
        
        .close-modal {
            font-size: 1.5rem;
            cursor: pointer;
            color: #888;
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .modal-body {
            margin-bottom: 25px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .reason-text {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            line-height: 1.8;
        }
        
        .approval-form {
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.success {
            background-color: #28a745;
        }
        
        .notification.error {
            background-color: #dc3545;
        }
        
        @media (max-width: 768px) {
            .card-content {
                grid-template-columns: 1fr;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .card-footer {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .action-buttons {
                width: 100%;
                justify-content: flex-start;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .filter-group {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-car"></i>
                <div>
                    <h1>ระบบอนุมัติการจองรถ</h1>
                    <p class="subtitle">Car Rent Approval System</p>
                </div>
            </div>
        </header>
        
        <div class="content">
            <div class="filters">
                <div class="filter-group">
                    <label for="departmentFilter">ฝ่าย/แผนก</label>
                    <select id="departmentFilter">
                        <option value="">ทั้งหมด</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="dateFilter">วันที่จอง</label>
                    <input type="date" id="dateFilter">
                </div>
                
                <div class="filter-group">
                    <label>สถานะ</label>
                    <div class="status-badges">
                        <div class="status-badge pending active" data-status="">ทั้งหมด</div>
                        <div class="status-badge pending" data-status="รออนุมัติ">รออนุมัติ</div>
                        <div class="status-badge approved" data-status="อนุมัติแล้ว">อนุมัติแล้ว</div>
                        <div class="status-badge rejected" data-status="ไม่อนุมัติ">ไม่อนุมัติ</div>
                    </div>
                </div>
            </div>
            
            <div id="loading" class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>กำลังโหลดข้อมูลการจองรถ...</p>
            </div>
            
            <div id="reservationsContainer" class="reservations-container" style="display: none;">
                <!-- ข้อมูลการจองจะแสดงที่นี่ -->
            </div>
        </div>
    </div>
    
    <!-- Modal สำหรับดูรายละเอียด -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">รายละเอียดการจองรถ</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="card-content">
                    <div class="info-group">
                        <div class="info-label">รหัสการจอง</div>
                        <div id="modalCode" class="info-value">-</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">ชื่อ-สกุล</div>
                        <div id="modalName" class="info-value">-</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">ฝ่าย/แผนก</div>
                        <div id="modalDepartment" class="info-value">-</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">ตำแหน่ง</div>
                        <div id="modalPosition" class="info-value">-</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">ประเภทรถ</div>
                        <div id="modalVehicle" class="info-value">-</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">วันที่เริ่มจอง</div>
                        <div id="modalStartDate" class="info-value">-</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">วันที่สิ้นสุดการจอง</div>
                        <div id="modalEndDate" class="info-value">-</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">เวลาเริ่มต้น</div>
                        <div id="modalStartTime" class="info-value">-</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">เวลาสิ้นสุด</div>
                        <div id="modalEndTime" class="info-value">-</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">ติดต่อ</div>
                        <div id="modalContact" class="info-value">-</div>
                    </div>
                </div>
                
                <div class="info-group">
                    <div class="info-label">วัตถุประสงค์</div>
                    <div id="modalReason" class="reason-text">-</div>
                </div>
                
                <div class="approval-form" id="approvalFormSection">
                    <div class="form-group">
                        <label for="approvalNote">หมายเหตุ (หากต้องการ)</label>
                        <textarea id="approvalNote" placeholder="ระบุหมายเหตุสำหรับการอนุมัติหรือไม่อนุมัติ..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-reject" id="btnRejectModal">
                    <i class="fas fa-times"></i> ไม่อนุมัติ
                </button>
                <button class="btn btn-approve" id="btnApproveModal">
                    <i class="fas fa-check"></i> อนุมัติ
                </button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div id="notification" class="notification"></div>
    
    <script>
        // ข้อมูลจำลองสำหรับทดสอบ
        const mockData = [
            {
                Timestamp: "2023-10-15 09:30:00",
                Code: "CAR-001",
                name: "สมชาย ใจดี",
                section: "ส่วนปฏิบัติการ",
                department: "ฝ่ายบัญชี",
                position: "ผู้จัดการฝ่าย",
                contact: "081-234-5678",
                choose: "รถยนต์ส่วนกลาง (Toyota Camry)",
                rentStartdate: "2023-10-20",
                rentEnddate: "2023-10-22",
                startTime: "09:00",
                endTime: "17:00",
                reason: "เดินทางไปประชุมกับลูกค้าที่จังหวัดเชียงใหม่",
                approval: "รออนุมัติ"
            },
            {
                Timestamp: "2023-10-16 14:20:00",
                Code: "CAR-002",
                name: "สุภาพร สวยงาม",
                section: "ส่วนสนับสนุน",
                department: "ฝ่ายบุคคล",
                position: "เจ้าหน้าที่ HR",
                contact: "082-345-6789",
                choose: "รถตู้ (Toyota Commuter)",
                rentStartdate: "2023-10-25",
                rentEnddate: "2023-10-25",
                startTime: "08:00",
                endTime: "16:00",
                reason: "ไปรับพนักงานใหม่ที่สนามบินสุวรรณภูมิ",
                approval: "อนุมัติแล้ว"
            },
            {
                Timestamp: "2023-10-17 11:15:00",
                Code: "CAR-003",
                name: "วิชัย กล้าหาญ",
                section: "ส่วนเทคนิค",
                department: "ฝ่ายไอที",
                position: "วิศวกรระบบ",
                contact: "083-456-7890",
                choose: "รถกระบะ (Isuzu D-Max)",
                rentStartdate: "2023-10-28",
                rentEnddate: "2023-10-29",
                startTime: "07:30",
                endTime: "18:00",
                reason: "ขนส่งอุปกรณ์คอมพิวเตอร์ไปยังสาขาภูเก็ต",
                approval: "ไม่อนุมัติ"
            }
        ];

        // URL ของ Google Apps Script
        const scriptUrl = 'https://script.google.com/macros/s/AKfycby7vS4CurNBg0zkf23it59Gp-QeMwTr6z-DPZwGKIPuRfV8fkYxaIjyL1RXH97fnfwQ/exec';
        
        // ตัวแปรเก็บข้อมูลการจอง
        let reservations = [];
        let currentReservation = null;
        
        // โหลดข้อมูลจาก Google Sheets เมื่อหน้าเว็บโหลดเสร็จ
        document.addEventListener('DOMContentLoaded', function() {
            loadReservations();
            
            // เพิ่ม event listeners
            document.getElementById('departmentFilter').addEventListener('change', filterReservations);
            document.getElementById('dateFilter').addEventListener('change', filterReservations);
            
            // สถานะ filter
            document.querySelectorAll('.status-badge').forEach(badge => {
                badge.addEventListener('click', function() {
                    document.querySelectorAll('.status-badge').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    filterReservations();
                });
            });
            
            // Modal close
            document.querySelector('.close-modal').addEventListener('click', closeModal);
            document.getElementById('btnApproveModal').addEventListener('click', approveReservation);
            document.getElementById('btnRejectModal').addEventListener('click', rejectReservation);
            
            // เรียกใช้ฟังก์ชันกรองเมื่อโหลดหน้าเสร็จ
            setTimeout(() => {
                populateDepartmentFilter();
                filterReservations();
            }, 500);
        });
        
        // ฟังก์ชันโหลดข้อมูลการจอง
        async function loadReservations() {
            try {
                // ในกรณีจริง ให้โหลดข้อมูลจาก Google Apps Script
                // const response = await fetch(scriptUrl);
                // const data = await response.json();
                // reservations = data;
                
                // สำหรับการทดสอบ ใช้ข้อมูลจำลอง
                reservations = mockData;
                
                // ซ่อน loading และแสดง container
                document.getElementById('loading').style.display = 'none';
                document.getElementById('reservationsContainer').style.display = 'block';
                
                // แสดงข้อมูลการจอง
                displayReservations(reservations);
                
                // แสดง notification สำเร็จ
                showNotification('โหลดข้อมูลการจองเรียบร้อยแล้ว', 'success');
            } catch (error) {
                console.error('Error loading reservations:', error);
                document.getElementById('loading').innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>เกิดข้อผิดพลาดในการโหลดข้อมูล: ${error.message}</p>
                    <p>กำลังแสดงข้อมูลตัวอย่าง...</p>
                `;
                
                // ใช้ข้อมูลจำลองถ้าโหลดไม่สำเร็จ
                setTimeout(() => {
                    reservations = mockData;
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('reservationsContainer').style.display = 'block';
                    displayReservations(reservations);
                }, 1000);
            }
        }
        
        // แสดงข้อมูลการจองในหน้าเว็บ
        function displayReservations(reservationsToShow) {
            const container = document.getElementById('reservationsContainer');
            
            if (reservationsToShow.length === 0) {
                container.innerHTML = '<div class="no-data">ไม่พบข้อมูลการจองรถ</div>';
                return;
            }
            
            let html = '';
            
            reservationsToShow.forEach(reservation => {
                // กำหนดคลาสสถานะ
                let statusClass = '';
                let statusText = '';
                
                if (reservation.approval === 'อนุมัติแล้ว') {
                    statusClass = 'approved';
                    statusText = 'อนุมัติแล้ว';
                } else if (reservation.approval === 'ไม่อนุมัติ') {
                    statusClass = 'rejected';
                    statusText = 'ไม่อนุมัติ';
                } else {
                    statusClass = 'pending';
                    statusText = 'รออนุมัติ';
                }
                
                html += `
                <div class="reservation-card ${statusClass}" data-code="${reservation.Code}">
                    <div class="card-header">
                        <div class="reservation-code">${reservation.Code}</div>
                        <div class="reservation-status ${statusClass}">${statusText}</div>
                    </div>
                    
                    <div class="card-content">
                        <div class="info-group">
                            <div class="info-label">ชื่อ-สกุล</div>
                            <div class="info-value">${reservation.name}</div>
                        </div>
                        
                        <div class="info-group">
                            <div class="info-label">ฝ่าย/แผนก</div>
                            <div class="info-value">${reservation.department}</div>
                        </div>
                        
                        <div class="info-group">
                            <div class="info-label">ตำแหน่ง</div>
                            <div class="info-value">${reservation.position}</div>
                        </div>
                        
                        <div class="info-group">
                            <div class="info-label">วันที่เริ่มจอง</div>
                            <div class="info-value">${formatDate(reservation.rentStartdate)}</div>
                        </div>
                        
                        <div class="info-group">
                            <div class="info-label">วันที่สิ้นสุด</div>
                            <div class="info-value">${formatDate(reservation.rentEnddate)}</div>
                        </div>
                        
                        <div class="info-group">
                            <div class="info-label">ประเภทรถ</div>
                            <div class="info-value">${reservation.choose}</div>
                        </div>
                    </div>
                    
                    <div class="card-footer">
                        <div class="timestamp">ส่งคำขอก่อนหน้า: ${formatDateTime(reservation.Timestamp)}</div>
                        <div class="action-buttons">
                            <button class="btn btn-view" onclick="viewReservationDetails('${reservation.Code}')">
                                <i class="fas fa-eye"></i> ดูรายละเอียด
                            </button>
                            
                            ${reservation.approval === 'รออนุมัติ' ? `
                            <button class="btn btn-approve" onclick="approveReservationFromCard('${reservation.Code}')">
                                <i class="fas fa-check"></i> อนุมัติ
                            </button>
                            <button class="btn btn-reject" onclick="rejectReservationFromCard('${reservation.Code}')">
                                <i class="fas fa-times"></i> ไม่อนุมัติ
                            </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // กรองข้อมูลการจองตาม filter
        function filterReservations() {
            const departmentFilter = document.getElementById('departmentFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            const statusFilter = document.querySelector('.status-badge.active').dataset.status;
            
            let filtered = reservations;
            
            // กรองตามฝ่าย/แผนก
            if (departmentFilter) {
                filtered = filtered.filter(reservation => 
                    reservation.department === departmentFilter
                );
            }
            
            // กรองตามวันที่
            if (dateFilter) {
                filtered = filtered.filter(reservation => 
                    reservation.rentStartdate === dateFilter || 
                    reservation.rentEnddate === dateFilter ||
                    (reservation.rentStartdate <= dateFilter && reservation.rentEnddate >= dateFilter)
                );
            }
            
            // กรองตามสถานะ
            if (statusFilter) {
                filtered = filtered.filter(reservation => reservation.approval === statusFilter);
            }
            
            displayReservations(filtered);
        }
        
        // เติมข้อมูลใน filter ฝ่าย/แผนก
        function populateDepartmentFilter() {
            const departments = [...new Set(reservations.map(r => r.department))];
            const select = document.getElementById('departmentFilter');
            
            departments.forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                select.appendChild(option);
            });
        }
        
        // ดูรายละเอียดการจอง
        function viewReservationDetails(code) {
            const reservation = reservations.find(r => r.Code === code);
            if (!reservation) return;
            
            currentReservation = reservation;
            
            // เติมข้อมูลใน modal
            document.getElementById('modalCode').textContent = reservation.Code;
            document.getElementById('modalName').textContent = reservation.name;
            document.getElementById('modalDepartment').textContent = `${reservation.department} / ${reservation.section}`;
            document.getElementById('modalPosition').textContent = reservation.position;
            document.getElementById('modalVehicle').textContent = reservation.choose;
            document.getElementById('modalStartDate').textContent = formatDate(reservation.rentStartdate);
            document.getElementById('modalEndDate').textContent = formatDate(reservation.rentEnddate);
            document.getElementById('modalStartTime').textContent = reservation.startTime;
            document.getElementById('modalEndTime').textContent = reservation.endTime;
            document.getElementById('modalContact').textContent = reservation.contact;
            document.getElementById('modalReason').textContent = reservation.reason;
            
            // ซ่อน/แสดงปุ่มอนุมัติตามสถานะ
            const approvalFormSection = document.getElementById('approvalFormSection');
            const modalFooter = document.querySelector('.modal-footer');
            
            if (reservation.approval === 'รออนุมัติ') {
                approvalFormSection.style.display = 'block';
                modalFooter.style.display = 'flex';
            } else {
                approvalFormSection.style.display = 'none';
                modalFooter.style.display = 'none';
            }
            
            // ล้าง note
            document.getElementById('approvalNote').value = '';
            
            // แสดง modal
            document.getElementById('detailModal').style.display = 'flex';
        }
        
        // ปิด modal
        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
            currentReservation = null;
        }
        
        // อนุมัติการจองจาก modal
        function approveReservation() {
            if (!currentReservation) return;
            
            const note = document.getElementById('approvalNote').value;
            updateApprovalStatus(currentReservation.Code, 'อนุมัติแล้ว', note);
        }
        
        // ไม่อนุมัติการจองจาก modal
        function rejectReservation() {
            if (!currentReservation) return;
            
            const note = document.getElementById('approvalNote').value;
            updateApprovalStatus(currentReservation.Code, 'ไม่อนุมัติ', note);
        }
        
        // อนุมัติการจองจาก card
        function approveReservationFromCard(code) {
            if (confirm('คุณต้องการอนุมัติการจองนี้ใช่หรือไม่?')) {
                updateApprovalStatus(code, 'อนุมัติแล้ว');
            }
        }
        
        // ไม่อนุมัติการจองจาก card
        function rejectReservationFromCard(code) {
            if (confirm('คุณต้องการไม่อนุมัติการจองนี้ใช่หรือไม่?')) {
                updateApprovalStatus(code, 'ไม่อนุมัติ');
            }
        }
        
        // อัพเดทสถานะการอนุมัติ
        async function updateApprovalStatus(code, status, note = '') {
            try {
                // ในกรณีจริง ให้ส่งข้อมูลไปยัง Google Apps Script
                // const response = await fetch(scriptUrl, {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json',
                //     },
                //     body: JSON.stringify({
                //         action: 'update',
                //         code: code,
                //         status: status,
                //         note: note
                //     })
                // });
                
                // สำหรับการทดสอบ อัพเดทข้อมูลใน array
                const index = reservations.findIndex(r => r.Code === code);
                if (index !== -1) {
                    reservations[index].approval = status;
                    
                    // อัพเดทการแสดงผล
                    filterReservations();
                    
                    // ปิด modal
                    closeModal();
                    
                    // แสดง notification
                    showNotification(`อัพเดทสถานะการจอง ${code} เป็น "${status}" เรียบร้อยแล้ว`, 'success');
                }
            } catch (error) {
                console.error('Error updating approval status:', error);
                showNotification('เกิดข้อผิดพลาดในการอัพเดทสถานะ', 'error');
            }
        }
        
        // แสดง notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // จัดรูปแบบวันที่
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        // จัดรูปแบบวันที่และเวลา
        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '-';
            const date = new Date(dateTimeString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // ปิด modal เมื่อคลิกนอกเนื้อหา
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('detailModal');
            if (event.target === modal) {
                closeModal();
            }
        });
    </script>
</body>
</html>
