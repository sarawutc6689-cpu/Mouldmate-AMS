<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบอนุมัติการจองรถ (Car Rent Approval)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Kanit', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 25px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.4rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        h1 i {
            margin-right: 15px;
            font-size: 2.2rem;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .sheet-info {
            background-color: rgba(255, 255, 255, 0.15);
            padding: 10px 15px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.9rem;
            word-break: break-all;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background-color: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 8px;
            min-width: 160px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.85;
        }
        
        .filters {
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        select, input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background-color: #f9f9f9;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .requests-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
            gap: 25px;
        }
        
        @media (max-width: 768px) {
            .requests-container {
                grid-template-columns: 1fr;
            }
        }
        
        .request-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.07);
            transition: transform 0.3s, box-shadow 0.3s;
            border-left: 5px solid #3498db;
        }
        
        .request-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .request-code {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            background-color: #f1f8ff;
            padding: 5px 12px;
            border-radius: 20px;
        }
        
        .request-date {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .requester-info {
            margin-bottom: 20px;
        }
        
        .requester-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .requester-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
        }
        
        .detail-item i {
            margin-right: 10px;
            color: #3498db;
            width: 20px;
        }
        
        .rent-details {
            background-color: #f9f9f9;
            padding: 18px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .rent-details h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        
        .rent-details h3 i {
            margin-right: 10px;
        }
        
        .time-range {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .time-item {
            flex: 1;
            min-width: 150px;
        }
        
        .time-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .time-value {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .reason-box {
            margin: 20px 0;
            padding: 15px;
            background-color: #fff8e1;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }
        
        .reason-box h4 {
            margin-bottom: 10px;
            color: #e65100;
            display: flex;
            align-items: center;
        }
        
        .reason-box h4 i {
            margin-right: 10px;
        }
        
        .reason-text {
            line-height: 1.6;
        }
        
        .approval-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn-approve {
            background-color: #27ae60;
            flex: 1;
        }
        
        .btn-approve:hover {
            background-color: #219653;
        }
        
        .btn-reject {
            background-color: #e74c3c;
            flex: 1;
        }
        
        .btn-reject:hover {
            background-color: #c0392b;
        }
        
        .status-pending {
            color: #f39c12;
            font-weight: bold;
            background-color: #fef5e7;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .status-approved {
            color: #27ae60;
            font-weight: bold;
            background-color: #eafaf1;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .status-rejected {
            color: #e74c3c;
            font-weight: bold;
            background-color: #fdedec;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: #7f8c8d;
            grid-column: 1 / -1;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.1rem;
            grid-column: 1 / -1;
        }
        
        .no-data i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #bdc3c7;
        }
        
        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-connected {
            background-color: #2ecc71;
        }
        
        .status-disconnected {
            background-color: #e74c3c;
        }
        
        .status-connecting {
            background-color: #f39c12;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: #27ae60;
        }
        
        .notification.error {
            background-color: #e74c3c;
        }
        
        .notification.info {
            background-color: #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-car"></i> ระบบอนุมัติการจองรถ</h1>
            <p class="subtitle">Car Rent Approval System</p>
            <div class="sheet-info">
                <i class="fas fa-link"></i> API URL: https://script.google.com/macros/s/AKfycbzReRwQHdUTdit1HMRCVVNlsGwpdvZMFG4fhsv5yh5nLpOE28NFuV2y_1OXPHU0DPkM/exec
            </div>
            
            <div class="api-status">
                <span class="status-indicator status-connecting" id="api-status-indicator"></span>
                <span id="api-status-text">กำลังเชื่อมต่อกับ Google Sheets...</span>
            </div>
            
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="total-requests">0</div>
                    <div class="stat-label">คำขอทั้งหมด</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="pending-requests">0</div>
                    <div class="stat-label">รอการอนุมัติ</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="approved-requests">0</div>
                    <div class="stat-label">อนุมัติแล้ว</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="rejected-requests">0</div>
                    <div class="stat-label">ปฏิเสธแล้ว</div>
                </div>
            </div>
        </header>
        
        <div class="filters">
            <div class="filter-group">
                <label for="filter-status"><i class="fas fa-filter"></i> สถานะการอนุมัติ</label>
                <select id="filter-status">
                    <option value="all">ทั้งหมด</option>
                    <option value="pending">รอการอนุมัติ</option>
                    <option value="approved">อนุมัติแล้ว</option>
                    <option value="rejected">ปฏิเสธแล้ว</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="filter-department"><i class="fas fa-building"></i> แผนก</label>
                <select id="filter-department">
                    <option value="all">ทั้งหมด</option>
                    <!-- ตัวเลือกแผนกจะถูกเพิ่มโดย JavaScript -->
                </select>
            </div>
            
            <div class="filter-group">
                <label for="filter-date"><i class="fas fa-calendar-alt"></i> วันที่จอง</label>
                <input type="date" id="filter-date">
            </div>
            
            <button id="refresh-btn">
                <i class="fas fa-sync-alt"></i> โหลดข้อมูลใหม่
            </button>
        </div>
        
        <div class="requests-container" id="requests-container">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i> กำลังโหลดข้อมูลจาก Google Sheets...
            </div>
        </div>
        
        <footer>
            <p>ระบบอนุมัติการจองรถ (Car Rent Approval System) | เชื่อมต่อกับ Google Sheets API</p>
            <p>© 2023 ฝ่ายบริหารงานทั่วไป</p>
        </footer>
    </div>

    <!-- Notification Container -->
    <div id="notification-container"></div>

    <script>
        // Google Apps Script URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzReRwQHdUTdit1HMRCVVNlsGwpdvZMFG4fhsv5yh5nLpOE28NFuV2y_1OXPHU0DPkM/exec';
        
        // ตัวแปรเก็บข้อมูลทั้งหมด
        let allRequests = [];
        let departments = [];
        
        // ฟังก์ชันหลักเมื่อโหลดหน้าเว็บ
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
        });
        
        // ตั้งค่า Event Listeners
        function setupEventListeners() {
            document.getElementById('filter-status').addEventListener('change', () => {
                displayRequests();
            });
            
            document.getElementById('filter-department').addEventListener('change', () => {
                displayRequests();
            });
            
            document.getElementById('filter-date').addEventListener('change', () => {
                displayRequests();
            });
            
            document.getElementById('refresh-btn').addEventListener('click', () => {
                loadData();
            });
        }
        
        // โหลดข้อมูลจาก Google Sheets
        async function loadData() {
            showLoading(true);
            updateApiStatus('กำลังเชื่อมต่อกับ Google Sheets...', 'connecting');
            
            try {
                // เรียก API เพื่อดึงข้อมูล
                const response = await fetch(SCRIPT_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    allRequests = data.data;
                    updateApiStatus('เชื่อมต่อกับ Google Sheets สำเร็จ', 'connected');
                    showNotification('โหลดข้อมูลสำเร็จ', 'success');
                    
                    // แยกแผนกที่ไม่ซ้ำกัน
                    extractDepartments();
                    
                    // แสดงข้อมูล
                    displayRequests();
                    updateStats();
                } else {
                    throw new Error(data.error || 'เกิดข้อผิดพลาดในการดึงข้อมูล');
                }
            } catch (error) {
                console.error('Error loading data:', error);
                updateApiStatus('ไม่สามารถเชื่อมต่อกับ Google Sheets', 'disconnected');
                showNotification(`ไม่สามารถโหลดข้อมูล: ${error.message}`, 'error');
                
                // แสดงข้อมูลตัวอย่างเพื่อทดสอบ
                loadSampleData();
            } finally {
                showLoading(false);
            }
        }
        
        // แยกแผนกต่างๆ จากข้อมูล
        function extractDepartments() {
            departments = ['all'];
            allRequests.forEach(request => {
                if (request.department && !departments.includes(request.department)) {
                    departments.push(request.department);
                }
            });
            
            // อัพเดทตัวเลือกแผนก
            const deptSelect = document.getElementById('filter-department');
            deptSelect.innerHTML = '<option value="all">ทั้งหมด</option>';
            
            departments.forEach(dept => {
                if (dept !== 'all') {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    deptSelect.appendChild(option);
                }
            });
        }
        
        // แสดงคำขอทั้งหมด
        function displayRequests() {
            const container = document.getElementById('requests-container');
            const statusFilter = document.getElementById('filter-status').value;
            const deptFilter = document.getElementById('filter-department').value;
            const dateFilter = document.getElementById('filter-date').value;
            
            // กรองข้อมูลตามเงื่อนไข
            let filteredRequests = allRequests.filter(request => {
                // กรองตามสถานะ
                if (statusFilter !== 'all' && request.approval !== statusFilter) {
                    return false;
                }
                
                // กรองตามแผนก
                if (deptFilter !== 'all' && request.department !== deptFilter) {
                    return false;
                }
                
                // กรองตามวันที่
                if (dateFilter && request.rentStartdate !== dateFilter) {
                    return false;
                }
                
                return true;
            });
            
            // ถ้าไม่มีข้อมูล
            if (filteredRequests.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>ไม่พบข้อมูลคำขอจองรถ</h3>
                        <p>ไม่มีคำขอจองรถที่ตรงกับเงื่อนไขการค้นหา</p>
                        <button onclick="loadData()" style="margin-top: 15px;">
                            <i class="fas fa-sync-alt"></i> โหลดข้อมูลใหม่
                        </button>
                    </div>
                `;
                return;
            }
            
            // เรียงลำดับตามวันที่ยื่นล่าสุด
            filteredRequests.sort((a, b) => new Date(b.Timestamp) - new Date(a.Timestamp));
            
            // สร้างการ์ดสำหรับแต่ละคำขอ
            container.innerHTML = '';
            filteredRequests.forEach(request => {
                const requestCard = createRequestCard(request);
                container.appendChild(requestCard);
            });
        }
        
        // สร้างการ์ดสำหรับแต่ละคำขอ
        function createRequestCard(request) {
            const card = document.createElement('div');
            card.className = 'request-card';
            card.id = `request-${request.Code}`;
            
            // กำหนดสีของ border ตามสถานะ
            let statusColor = '#3498db'; // ปกติ (pending)
            let statusText = 'รอการอนุมัติ';
            let statusClass = 'status-pending';
            
            if (request.approval === 'approved') {
                statusColor = '#27ae60';
                statusText = 'อนุมัติแล้ว';
                statusClass = 'status-approved';
            } else if (request.approval === 'rejected') {
                statusColor = '#e74c3c';
                statusText = 'ปฏิเสธแล้ว';
                statusClass = 'status-rejected';
            }
            
            card.style.borderLeftColor = statusColor;
            
            // แปลงวันที่ให้อ่านง่าย
            const thaiDate = formatDate(request.rentStartdate);
            const thaiEndDate = formatDate(request.rentEnddate);
            
            card.innerHTML = `
                <div class="card-header">
                    <div>
                        <div class="request-code">${request.Code || 'ไม่มีรหัส'}</div>
                        <div class="request-date">ยื่นเมื่อ: ${request.Timestamp || 'ไม่ระบุ'}</div>
                    </div>
                    <div class="${statusClass}">${statusText}</div>
                </div>
                
                <div class="requester-info">
                    <div class="requester-name">${request.name || 'ไม่ระบุชื่อ'}</div>
                    <div class="requester-details">
                        <div class="detail-item">
                            <i class="fas fa-building"></i>
                            <span>${request.department || 'ไม่ระบุ'} / ${request.section || 'ไม่ระบุ'}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-briefcase"></i>
                            <span>${request.position || 'ไม่ระบุ'}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-phone"></i>
                            <span>${request.contact || 'ไม่ระบุ'}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-car"></i>
                            <span>${request.choose || 'ไม่ระบุยี่ห้อ'}</span>
                        </div>
                    </div>
                </div>
                
                <div class="rent-details">
                    <h3><i class="fas fa-calendar-alt"></i> รายละเอียดการจอง</h3>
                    <div class="time-range">
                        <div class="time-item">
                            <div class="time-label">วันที่เริ่มจอง</div>
                            <div class="time-value">${thaiDate}</div>
                        </div>
                        <div class="time-item">
                            <div class="time-label">วันที่สิ้นสุดการจอง</div>
                            <div class="time-value">${thaiEndDate}</div>
                        </div>
                        <div class="time-item">
                            <div class="time-label">เวลาเริ่มต้น</div>
                            <div class="time-value">${request.startTime || 'ไม่ระบุ'} น.</div>
                        </div>
                        <div class="time-item">
                            <div class="time-label">เวลาสิ้นสุด</div>
                            <div class="time-value">${request.endTime || 'ไม่ระบุ'} น.</div>
                        </div>
                    </div>
                </div>
                
                <div class="reason-box">
                    <h4><i class="fas fa-comment-dots"></i> เหตุผลในการจองรถ</h4>
                    <div class="reason-text">${request.reason || 'ไม่ระบุเหตุผล'}</div>
                </div>
                
                <div class="approval-actions">
                    <button class="btn-approve" onclick="updateApproval('${request.Code}', 'approved')" ${request.approval !== 'pending' ? 'disabled style="opacity:0.6; cursor:not-allowed;"' : ''}>
                        <i class="fas fa-check-circle"></i> อนุมัติ
                    </button>
                    <button class="btn-reject" onclick="updateApproval('${request.Code}', 'rejected')" ${request.approval !== 'pending' ? 'disabled style="opacity:0.6; cursor:not-allowed;"' : ''}>
                        <i class="fas fa-times-circle"></i> ปฏิเสธ
                    </button>
                </div>
            `;
            
            return card;
        }
        
        // อัพเดทสถานะการอนุมัติ
        async function updateApproval(code, status) {
            const actionText = status === 'approved' ? 'อนุมัติ' : 'ปฏิเสธ';
            
            if (!confirm(`คุณต้องการ${actionText}คำขอจองรถ ${code} ใช่หรือไม่?`)) {
                return;
            }
            
            showLoading(true);
            
            try {
                // ส่งข้อมูลไปยัง Google Apps Script
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'update',
                        code: code,
                        approval: status
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`${actionText}คำขอ ${code} สำเร็จ`, 'success');
                    
                    // อัพเดทข้อมูลใน allRequests
                    const requestIndex = allRequests.findIndex(r => r.Code === code);
                    if (requestIndex !== -1) {
                        allRequests[requestIndex].approval = status;
                        
                        // อัพเดทการแสดงผล
                        displayRequests();
                        updateStats();
                    }
                } else {
                    throw new Error(result.error || `ไม่สามารถ${actionText}คำขอได้`);
                }
            } catch (error) {
                console.error('Error updating approval:', error);
                showNotification(`ไม่สามารถ${actionText}คำขอ: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // อัพเดทสถิติ
        function updateStats() {
            const total = allRequests.length;
            const pending = allRequests.filter(r => r.approval === 'pending').length;
            const approved = allRequests.filter(r => r.approval === 'approved').length;
            const rejected = allRequests.filter(r => r.approval === 'rejected').length;
            
            document.getElementById('total-requests').textContent = total;
            document.getElementById('pending-requests').textContent = pending;
            document.getElementById('approved-requests').textContent = approved;
            document.getElementById('rejected-requests').textContent = rejected;
        }
        
        // อัพเดทสถานะการเชื่อมต่อ API
        function updateApiStatus(message, status) {
            const indicator = document.getElementById('api-status-indicator');
            const text = document.getElementById('api-status-text');
            
            text.textContent = message;
            
            // ลบคลาสสถานะเก่าทั้งหมด
            indicator.classList.remove('status-connected', 'status-disconnected', 'status-connecting');
            
            // เพิ่มคลาสสถานะใหม่
            indicator.classList.add(`status-${status}`);
        }
        
        // แสดง/ซ่อนสถานะ loading
        function showLoading(show) {
            const refreshBtn = document.getElementById('refresh-btn');
            if (show) {
                refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> กำลังโหลด...';
                refreshBtn.disabled = true;
            } else {
                refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> โหลดข้อมูลใหม่';
                refreshBtn.disabled = false;
            }
        }
        
        // แสดงการแจ้งเตือน
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            // แสดงการแจ้งเตือน
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // ซ่อนการแจ้งเตือนหลังจาก 3 วินาที
            setTimeout(() => {
                notification.classList.remove('show');
                
                // ลบการแจ้งเตือนออกจาก DOM หลังจาก animation
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
        
        // โหลดข้อมูลตัวอย่างเมื่อไม่สามารถเชื่อมต่อ API ได้
        function loadSampleData() {
            const sampleData = [
                {
                    Timestamp: "2023-10-15 09:30:00",
                    Code: "CR-2023-001",
                    name: "สมชาย ใจดี",
                    section: "การเงิน",
                    department: "บัญชี",
                    position: "ผู้จัดการ",
                    contact: "089-123-4567",
                    choose: "รถยนต์ Nissan Almera",
                    rentStartdate: "2023-10-20",
                    rentEnddate: "2023-10-22",
                    startTime: "09:00",
                    endTime: "17:00",
                    reason: "นำทีมงานไปประชุมกับลูกค้าที่จังหวัดชลบุรี",
                    approval: "pending"
                },
                {
                    Timestamp: "2023-10-14 14:20:00",
                    Code: "CR-2023-002",
                    name: "สุนิสา ราตรี",
                    section: "ตลาด",
                    department: "ขาย",
                    position: "หัวหน้าแผนก",
                    contact: "082-987-6543",
                    choose: "รถยนต์ Toyota Yaris",
                    rentStartdate: "2023-10-18",
                    rentEnddate: "2023-10-18",
                    startTime: "08:30",
                    endTime: "16:30",
                    reason: "นำสินค้าไปจัดแสดงในงานแสดงสินค้า",
                    approval: "approved"
                },
                {
                    Timestamp: "2023-10-13 11:15:00",
                    Code: "CR-2023-003",
                    name: "อนุชา ศรีสุวรรณ",
                    section: "คลังสินค้า",
                    department: "จัดซื้อ",
                    position: "พนักงาน",
                    contact: "086-555-7890",
                    choose: "รถกระบะ Toyota Hilux",
                    rentStartdate: "2023-10-25",
                    rentEnddate: "2023-10-25",
                    startTime: "07:00",
                    endTime: "18:00",
                    reason: "ไปรับสินค้าจากผู้ผลิตที่จังหวัดอยุธยา",
                    approval: "pending"
                }
            ];
            
            allRequests = sampleData;
            extractDepartments();
            displayRequests();
            updateStats();
            showNotification('กำลังใช้ข้อมูลตัวอย่างสำหรับการทดสอบ', 'info');
        }
        
        // จัดรูปแบบวันที่
        function formatDate(dateString) {
            if (!dateString) return 'ไม่ระบุ';
            
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return dateString;
            
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear() + 543; // แปลงเป็นพ.ศ.
            
            return `${day}/${month}/${year}`;
        }
    </script>
</body>
</html>
